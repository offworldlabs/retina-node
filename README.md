# retina-node

Orchestrator repository for Retina passive radar nodes. Manages docker-compose configuration and Mender OTA artifact generation.

Deploy to nodes running owl-os via the Mender dashboard.

## Web Interfaces

| Service | URL | Description |
|---------|-----|-------------|
| blah2 | `http://<PI_IP>:8080` or `http://retina.local:8080` | Passive radar UI |
| tar1090 | `http://<PI_IP>` or `http://retina.local` | ADS-B aircraft map |
| adsb2dd | `http://<PI_IP>:49155` or `http://retina.local:49155` | Delay-Doppler converter |

## Node Access

Access nodes via Mender troubleshooting terminal.

```
/data/
├── mender-app/retina-node/manifests/
│   ├── docker-compose.yaml    # Deployed compose file
│   └── .env                   # Environment vars (copied by config-merger and autogenerated)
│
└── retina-node/
    ├── config/
    │   ├── user.yml           # User config overrides (edit this)
    │   ├── config.yml         # Merged blah2 config (auto-generated)
    └── blah2/
        ├── save/              # Persistent radar data
        ├── script/            # Runtime scripts
        └── test/              # Test data
```

## Configuration

Config-merger generates config files at startup by merging:

```
default.yml → user.yml → forced.yml
```

Later files override earlier ones.

### Editing Config on a Node

```bash
# 1. Edit config
sudo nano /data/retina-node/config/user.yml

# 2. Regenerate .env and restart services
cd /data/mender-app/retina-node/manifests
sudo docker compose run --rm config-merger
sudo docker compose down && sudo docker compose up -d

# 3. Verify
cat /data/retina-node/config/config.yml
```

### First Deployment

After initial Mender deployment, run config-merger and restart to apply config:

```bash
cd /data/mender-app/retina-node/manifests
sudo docker compose run --rm config-merger
sudo docker compose down && sudo docker compose up -d
```

### Editing Default/Forced Config

Edit files in `config-merger/config/` directory in this repo, then rebuild and deploy.

## Creating a Release

1. Update `docker-compose.yml` with desired package versions
2. Tag with `git tag vX.X.X` and push
3. CI workflow generates Mender artifact and uploads to dashboard
